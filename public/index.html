<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Claude Remote CLI</title>
  <link rel="stylesheet" href="/vendor/xterm.css" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>

  <!-- PIN Gate -->
  <div id="pin-gate">
    <div class="pin-container">
      <h1>Claude Remote CLI</h1>
      <p>Enter PIN to continue</p>
      <input
        type="password"
        id="pin-input"
        inputmode="numeric"
        maxlength="20"
        placeholder="PIN"
        autofocus
      />
      <button id="pin-submit">Unlock</button>
      <p id="pin-error" class="error" hidden></p>
    </div>
  </div>

  <!-- Main App (hidden until PIN unlocked) -->
  <div id="main-app" hidden>

    <!-- Sidebar -->
    <div id="sidebar">
      <div class="sidebar-header">
        <span class="sidebar-label">Sessions</span>
        <button id="sidebar-toggle" class="icon-btn" aria-label="Toggle sidebar">&#9776;</button>
      </div>
      <div class="sidebar-filters">
        <select id="sidebar-root-filter">
          <option value="">All roots</option>
        </select>
        <select id="sidebar-repo-filter">
          <option value="">All repos</option>
        </select>
        <input type="text" id="session-filter" placeholder="Filter..." />
      </div>
      <ul id="session-list"></ul>
      <button id="new-session-btn">+ New Session</button>
      <button id="settings-btn">Settings</button>
    </div>

    <!-- Sidebar Overlay (mobile) -->
    <div id="sidebar-overlay"></div>

    <!-- Terminal Area -->
    <div id="terminal-area">
      <div id="mobile-header">
        <button id="menu-btn" class="icon-btn" aria-label="Open sessions menu">&#9776;</button>
        <span id="session-title" class="mobile-title">No session</span>
      </div>
      <input type="text" id="mobile-input" autocomplete="on" autocorrect="on" autocapitalize="sentences" spellcheck="true" aria-label="Terminal input" />
      <div id="terminal-container"></div>
      <div id="terminal-scrollbar"><div id="terminal-scrollbar-thumb"></div></div>
      <div id="no-session-msg">No active session. Create or select a session to begin.</div>

      <!-- Touch Toolbar -->
      <div id="toolbar">
        <div class="toolbar-grid">
          <button class="tb-btn" data-key="&#x09;" aria-label="Tab">Tab</button>
          <button class="tb-btn" data-key="&#x1b;[Z" aria-label="Shift+Tab">&#8679;Tab</button>
          <button class="tb-btn tb-arrow" data-key="&#x1b;[A" aria-label="Up arrow">&#8593;</button>
          <button class="tb-btn" data-key="&#x1b;" aria-label="Escape">Esc</button>
          <button class="tb-btn" id="upload-image-btn" aria-label="Upload image">&#128247;</button>
          <button class="tb-btn" data-key="&#x03;" aria-label="Ctrl+C">^C</button>
          <button class="tb-btn tb-arrow" data-key="&#x1b;[D" aria-label="Left arrow">&#8592;</button>
          <button class="tb-btn tb-arrow" data-key="&#x1b;[B" aria-label="Down arrow">&#8595;</button>
          <button class="tb-btn tb-arrow" data-key="&#x1b;[C" aria-label="Right arrow">&#8594;</button>
          <button class="tb-btn tb-enter" data-key="&#x0d;" aria-label="Enter">&#9166;</button>
        </div>
      </div>
    </div>

    <!-- Update Toast -->
    <div id="update-toast" hidden>
      <div id="update-toast-content">
        <span id="update-toast-text"></span>
        <div id="update-toast-actions">
          <button id="update-toast-btn" class="btn-accent">Update Now</button>
          <button id="update-toast-dismiss" aria-label="Dismiss">&times;</button>
        </div>
      </div>
    </div>

    <!-- Hidden file input for mobile image upload -->
    <input type="file" id="image-file-input" accept="image/*" hidden />

    <!-- Image Paste Toast -->
    <div id="image-toast" hidden>
      <div id="image-toast-content">
        <span id="image-toast-text"></span>
        <div id="image-toast-actions">
          <button id="image-toast-insert" class="btn-accent" hidden>Insert Path</button>
          <button id="image-toast-dismiss" aria-label="Dismiss">&times;</button>
        </div>
      </div>
    </div>

  </div>

  <!-- New Session Dialog -->
  <dialog id="new-session-dialog">
    <h2>New Session</h2>

    <div class="dialog-field">
      <label for="dialog-root-select">Root</label>
      <select id="dialog-root-select"><option value="">Select a root...</option></select>
    </div>

    <div class="dialog-field">
      <label for="dialog-repo-select">Repo</label>
      <select id="dialog-repo-select" disabled><option value="">Select a repo...</option></select>
    </div>

    <hr class="dialog-separator" />
    <div class="dialog-custom-path">
      <label for="custom-path-input">Or enter a local path:</label>
      <input type="text" id="custom-path-input" placeholder="/Users/you/code/my-repo" />
    </div>
    <div class="dialog-option">
      <label>
        <input type="checkbox" id="dialog-yolo" />
        Yolo mode
      </label>
      <span class="dialog-option-hint">Skip all permission prompts</span>
    </div>
    <div class="dialog-actions">
      <button id="dialog-cancel">Cancel</button>
      <button id="dialog-start" class="btn-accent">New Worktree</button>
    </div>
  </dialog>

  <!-- Settings Dialog -->
  <dialog id="settings-dialog">
    <h2>Settings</h2>
    <div class="settings-section">
      <label class="settings-label">Root Directories</label>
      <p class="settings-hint">Add folders that contain your repos. The app scans one level deep for git repos.</p>
      <div id="settings-roots-list"></div>
      <div class="settings-add-repo">
        <input type="text" id="add-root-path" placeholder="/Users/you/code" />
        <button id="add-root-btn" class="btn-accent">Add</button>
      </div>
    </div>
    <div class="dialog-actions">
      <button id="settings-close">Done</button>
    </div>
  </dialog>

  <!-- Context Menu -->
  <div id="context-menu" class="context-menu" hidden>
    <button id="ctx-resume-yolo" class="context-menu-item">Resume in yolo mode</button>
    <button id="ctx-delete-worktree" class="context-menu-item ctx-danger">Delete worktree</button>
  </div>

  <!-- Delete Worktree Confirmation Dialog -->
  <dialog id="delete-worktree-dialog">
    <h2>Delete worktree?</h2>
    <p class="delete-wt-warning">This will remove the worktree directory and delete its branch. This cannot be undone.</p>
    <p class="delete-wt-name" id="delete-wt-name"></p>
    <div class="dialog-actions">
      <button id="delete-wt-cancel">Cancel</button>
      <button id="delete-wt-confirm" class="btn-danger">Delete</button>
    </div>
  </dialog>

  <script src="/vendor/xterm.js"></script>
  <script src="/vendor/addon-fit.js"></script>
  <script src="/app.js"></script>
</body>
</html>
